{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workbookDisplayName": {
      "type": "string",
      "defaultValue": "Azure OpenAI & Cognitive Services Cross-Subscription Metrics",
      "metadata": {
        "description": "The display name of the workbook."
      }
    },
    "workbookSourceId": {
      "type": "string",
      "defaultValue": "Azure Monitor",
      "metadata": {
        "description": "The source for the workbook. Use 'Azure Monitor' for a general workbook."
      }
    },
    "workbookType": {
      "type": "string",
      "defaultValue": "workbook",
      "metadata": {
        "description": "The type of workbook. 'workbook' for a standard Azure Monitor Workbook."
      }
    },
    "location": {
      "type": "string",
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Location for the workbook resource."
      }
    }
  },
  "variables": {
    "workbookId": "[guid(resourceGroup().id, parameters('workbookDisplayName'))]"
  },
  "resources": [
    {
      "type": "microsoft.insights/workbooks",
      "apiVersion": "2022-04-01",
      "name": "[variables('workbookId')]",
      "location": "[parameters('location')]",
      "kind": "shared",
      "properties": {
        "displayName": "[parameters('workbookDisplayName')]",
        "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# Azure OpenAI & Cognitive Services \\u2014 Cross\\u2011Subscription Metrics\\n\\nThis workbook provides a **single pane of glass** for monitoring Azure OpenAI and Cognitive Services metrics across multiple subscriptions using **Azure Monitor Metrics directly** \\u2014 no Log Analytics Workspace required.\\n\\n> **Why Azure Monitor Metrics instead of Log Analytics?**  Because platform metrics are emitted automatically for every Cognitive Services resource. There is no dependency on diagnostic settings or a shared Log Analytics Workspace, which eliminates gaps when resources span multiple workspaces or have no workspace configured.\\n\\nUse the parameters below to select subscriptions, resource groups, and specific resources.\"},\"name\":\"workbook-header\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"value::all\"],\"parameters\":[{\"id\":\"1f74ed9a-e3ed-498d-bd5b-f68f3836a117\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Subscriptions\",\"label\":\"Subscriptions\",\"type\":6,\"description\":\"Select one or more Azure subscriptions\",\"isRequired\":true,\"multiSelect\":true,\"showDefault\":false,\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"includeAll\":true,\"showDefault\":false},\"value\":[\"value::all\"]},{\"id\":\"b616a3a3-4271-4208-b1a9-a2a43f7a2e1c\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"ResourceGroups\",\"label\":\"Resource Groups\",\"type\":2,\"description\":\"Select one or more resource groups\",\"isRequired\":false,\"multiSelect\":true,\"showDefault\":false,\"query\":\"Resources\\n| where type =~ 'microsoft.cognitiveservices/accounts'\\n| summarize by resourceGroup\\n| order by resourceGroup asc\\n| project id=resourceGroup, label=resourceGroup\",\"crossComponentResources\":[\"{Subscriptions}\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"value\":[\"value::all\"]},{\"id\":\"0e85e0e4-a7e8-4ea8-b291-e444c317843a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Resources\",\"label\":\"Cognitive Services Resources\",\"type\":5,\"description\":\"Select one or more Cognitive Services resources\",\"isRequired\":true,\"multiSelect\":true,\"showDefault\":false,\"query\":\"Resources\\n| where type =~ 'microsoft.cognitiveservices/accounts'\\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\\n| order by name asc\\n| extend Rank = row_number()\\n| project value = id, label = name, selected = Rank <= 10, group = resourceGroup\",\"crossComponentResources\":[\"{Subscriptions}\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"value\":[\"value::all\"]},{\"id\":\"c4b69c01-2263-4ada-8d9c-43433b739ff3\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"label\":\"Time Range\",\"type\":4,\"description\":\"Select the time range for metrics\",\"isRequired\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2592000000}],\"allowCustom\":true},\"value\":{\"durationMs\":86400000}},{\"id\":\"d5e1e93b-4a3e-4b9f-bf4d-8c2a5e2e3b9a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Aggregation\",\"label\":\"Aggregation\",\"type\":2,\"description\":\"Select the time grain for metric aggregation\",\"isRequired\":true,\"typeSettings\":{\"additionalResourceOptions\":[]},\"jsonData\":\"[{\\\"value\\\":\\\"PT1M\\\",\\\"label\\\":\\\"1 minute\\\"},{\\\"value\\\":\\\"PT5M\\\",\\\"label\\\":\\\"5 minutes\\\"},{\\\"value\\\":\\\"PT15M\\\",\\\"label\\\":\\\"15 minutes\\\"},{\\\"value\\\":\\\"PT30M\\\",\\\"label\\\":\\\"30 minutes\\\"},{\\\"value\\\":\\\"PT1H\\\",\\\"label\\\":\\\"1 hour\\\"},{\\\"value\\\":\\\"PT6H\\\",\\\"label\\\":\\\"6 hours\\\"},{\\\"value\\\":\\\"PT12H\\\",\\\"label\\\":\\\"12 hours\\\"},{\\\"value\\\":\\\"P1D\\\",\\\"label\\\":\\\"1 day\\\"}]\",\"value\":\"PT1H\"}],\"style\":\"above\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"name\":\"parameters\"},{\"type\":1,\"content\":{\"json\":\"---\\n## Resource Inventory\\nAll Cognitive Services resources across the selected subscriptions and resource groups.\"},\"name\":\"inventory-header\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Resources\\n| where type =~ 'microsoft.cognitiveservices/accounts'\\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\\n| project Resource=name, ['Resource Group']=resourceGroup, Location=location, Kind=kind, SKU=sku.name, Subscription=subscriptionId\\n| order by Resource asc\",\"size\":0,\"showAnalytics\":true,\"title\":\"Cognitive Services Resources\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Resource\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"25%\"}},{\"columnMatch\":\"Resource Group\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"20%\"}},{\"columnMatch\":\"Location\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"15%\"}},{\"columnMatch\":\"Kind\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"15%\"}},{\"columnMatch\":\"SKU\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"10%\"}},{\"columnMatch\":\"Subscription\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"15%\"}}],\"sortBy\":[{\"itemKey\":\"Resource\",\"sortOrder\":1}]},\"sortBy\":[{\"itemKey\":\"Resource\",\"sortOrder\":1}]},\"name\":\"resource-inventory-grid\"},{\"type\":1,\"content\":{\"json\":\"---\\n## PTU Utilization\\nProvisioned\\u2011managed throughput utilization across selected Azure OpenAI resources. This metric shows the percentage of provisioned capacity being consumed and is critical for right\\u2011sizing PTU deployments.\\n\\n> This metric is only emitted by **provisioned (PTU)** deployments. Pay\\u2011as\\u2011you\\u2011go deployments will not report utilization.\"},\"name\":\"ptu-utilization-header\"},{\"type\":10,\"content\":{\"chartId\":\"workbooka1b2c3d4-e5f6-7890-abcd-ef1234567890\",\"version\":\"MetricsItem/2.0\",\"size\":0,\"chartType\":2,\"resourceType\":\"microsoft.cognitiveservices/accounts\",\"metricScope\":0,\"resourceIds\":[\"{Resources}\"],\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"metrics\":[{\"namespace\":\"microsoft.cognitiveservices/accounts\",\"metric\":\"microsoft.cognitiveservices/accounts-AllMetrics-ProvisionedManagedUtilizationV2\",\"aggregation\":4,\"splitBy\":null}],\"title\":\"Provisioned\\u2011Managed Utilization V2 (avg %)\",\"gridFormatType\":1,\"tileSettings\":{\"showBorder\":false}},\"name\":\"ptu-utilization-chart\"},{\"type\":1,\"content\":{\"json\":\"---\\n## Azure OpenAI Requests\\nTotal Azure OpenAI API requests across selected resources. Use this alongside PTU Utilization to correlate request volume with capacity consumption.\"},\"name\":\"openai-requests-header\"},{\"type\":10,\"content\":{\"chartId\":\"workbookb2c3d4e5-f6a7-8901-bcde-f12345678901\",\"version\":\"MetricsItem/2.0\",\"size\":0,\"chartType\":2,\"resourceType\":\"microsoft.cognitiveservices/accounts\",\"metricScope\":0,\"resourceIds\":[\"{Resources}\"],\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"metrics\":[{\"namespace\":\"microsoft.cognitiveservices/accounts\",\"metric\":\"microsoft.cognitiveservices/accounts-AllMetrics-AzureOpenAIRequests\",\"aggregation\":1,\"splitBy\":null}],\"title\":\"Azure OpenAI Requests (sum)\",\"gridFormatType\":1,\"tileSettings\":{\"showBorder\":false}},\"name\":\"openai-requests-chart\"},{\"type\":1,\"content\":{\"json\":\"---\\n## Request Volume (All Cognitive Services)\\nTotal API calls across all selected Cognitive Services resources (includes both OpenAI and non\\u2011OpenAI resource types).\"},\"name\":\"request-volume-header\"},{\"type\":10,\"content\":{\"chartId\":\"workbookdb24c76e-73a7-4572-a560-7f4ea64c7f55\",\"version\":\"MetricsItem/2.0\",\"size\":0,\"chartType\":2,\"resourceType\":\"microsoft.cognitiveservices/accounts\",\"metricScope\":0,\"resourceIds\":[\"{Resources}\"],\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"metrics\":[{\"namespace\":\"microsoft.cognitiveservices/accounts\",\"metric\":\"microsoft.cognitiveservices/accounts-AllMetrics-TotalCalls\",\"aggregation\":1,\"splitBy\":null}],\"title\":\"Total Calls (sum)\",\"gridFormatType\":1,\"tileSettings\":{\"showBorder\":false},\"graphSettings\":{\"type\":0},\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"microsoft.cognitiveservices/accounts-AllMetrics-TotalCalls\",\"sortOrder\":2}]}},\"name\":\"total-calls-chart\"},{\"type\":1,\"content\":{\"json\":\"---\\n## Success vs Errors\\nBreakdown of successful calls, errors, and blocked (throttled) calls.\"},\"name\":\"success-errors-header\"},{\"type\":10,\"content\":{\"chartId\":\"workbook3b7c2d6f-9a8e-4f21-b3d5-1c2e3f4a5b6d\",\"version\":\"MetricsItem/2.0\",\"size\":0,\"chartType\":2,\"resourceType\":\"microsoft.cognitiveservices/accounts\",\"metricScope\":0,\"resourceIds\":[\"{Resources}\"],\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"metrics\":[{\"namespace\":\"microsoft.cognitiveservices/accounts\",\"metric\":\"microsoft.cognitiveservices/accounts-AllMetrics-SuccessfulCalls\",\"aggregation\":1,\"splitBy\":null},{\"namespace\":\"microsoft.cognitiveservices/accounts\",\"metric\":\"microsoft.cognitiveservices/accounts-AllMetrics-TotalErrors\",\"aggregation\":1,\"splitBy\":null},{\"namespace\":\"microsoft.cognitiveservices/accounts\",\"metric\":\"microsoft.cognitiveservices/accounts-AllMetrics-BlockedCalls\",\"aggregation\":1,\"splitBy\":null}],\"title\":\"Successful Calls vs Errors vs Blocked Calls\",\"gridFormatType\":1,\"tileSettings\":{\"showBorder\":false}},\"name\":\"success-errors-chart\"},{\"type\":1,\"content\":{\"json\":\"---\\n## Latency\\nAverage latency (in milliseconds) for API calls.\"},\"name\":\"latency-header\"},{\"type\":10,\"content\":{\"chartId\":\"workbook4e5f6a7b-8c9d-0e1f-2a3b-4c5d6e7f8a9b\",\"version\":\"MetricsItem/2.0\",\"size\":0,\"chartType\":2,\"resourceType\":\"microsoft.cognitiveservices/accounts\",\"metricScope\":0,\"resourceIds\":[\"{Resources}\"],\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"metrics\":[{\"namespace\":\"microsoft.cognitiveservices/accounts\",\"metric\":\"microsoft.cognitiveservices/accounts-AllMetrics-Latency\",\"aggregation\":4,\"splitBy\":null}],\"title\":\"Average Latency (ms)\",\"gridFormatType\":1,\"tileSettings\":{\"showBorder\":false}},\"name\":\"latency-chart\"},{\"type\":1,\"content\":{\"json\":\"---\\n## Token Usage (Azure OpenAI)\\nPrompt tokens (input), generated tokens (output), and total token transactions. These metrics are emitted by Azure OpenAI resource types and are key indicators of workload volume on PTU deployments.\"},\"name\":\"token-usage-header\"},{\"type\":10,\"content\":{\"chartId\":\"workbook5f6a7b8c-9d0e-1f2a-3b4c-5d6e7f8a9b0c\",\"version\":\"MetricsItem/2.0\",\"size\":0,\"chartType\":2,\"resourceType\":\"microsoft.cognitiveservices/accounts\",\"metricScope\":0,\"resourceIds\":[\"{Resources}\"],\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"metrics\":[{\"namespace\":\"microsoft.cognitiveservices/accounts\",\"metric\":\"microsoft.cognitiveservices/accounts-AllMetrics-ProcessedPromptTokens\",\"aggregation\":1,\"splitBy\":null},{\"namespace\":\"microsoft.cognitiveservices/accounts\",\"metric\":\"microsoft.cognitiveservices/accounts-AllMetrics-GeneratedTokens\",\"aggregation\":1,\"splitBy\":null},{\"namespace\":\"microsoft.cognitiveservices/accounts\",\"metric\":\"microsoft.cognitiveservices/accounts-AllMetrics-TokenTransaction\",\"aggregation\":1,\"splitBy\":null}],\"title\":\"Token Usage (Prompt, Generated, Transactions)\",\"gridFormatType\":1,\"tileSettings\":{\"showBorder\":false}},\"name\":\"token-usage-chart\"},{\"type\":1,\"content\":{\"json\":\"---\\n## Data Transfer\\nIncoming and outgoing data volume.\"},\"name\":\"data-transfer-header\"},{\"type\":10,\"content\":{\"chartId\":\"workbook6a7b8c9d-0e1f-2a3b-4c5d-6e7f8a9b0c1d\",\"version\":\"MetricsItem/2.0\",\"size\":0,\"chartType\":2,\"resourceType\":\"microsoft.cognitiveservices/accounts\",\"metricScope\":0,\"resourceIds\":[\"{Resources}\"],\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"metrics\":[{\"namespace\":\"microsoft.cognitiveservices/accounts\",\"metric\":\"microsoft.cognitiveservices/accounts-AllMetrics-DataIn\",\"aggregation\":1,\"splitBy\":null},{\"namespace\":\"microsoft.cognitiveservices/accounts\",\"metric\":\"microsoft.cognitiveservices/accounts-AllMetrics-DataOut\",\"aggregation\":1,\"splitBy\":null}],\"title\":\"Data In / Data Out (bytes)\",\"gridFormatType\":1,\"tileSettings\":{\"showBorder\":false}},\"name\":\"data-transfer-chart\"},{\"type\":1,\"content\":{\"json\":\"---\\n## Server & Client Errors\\nBreakdown of server-side and client-side errors.\"},\"name\":\"error-breakdown-header\"},{\"type\":10,\"content\":{\"chartId\":\"workbook7b8c9d0e-1f2a-3b4c-5d6e-7f8a9b0c1d2e\",\"version\":\"MetricsItem/2.0\",\"size\":0,\"chartType\":2,\"resourceType\":\"microsoft.cognitiveservices/accounts\",\"metricScope\":0,\"resourceIds\":[\"{Resources}\"],\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"metrics\":[{\"namespace\":\"microsoft.cognitiveservices/accounts\",\"metric\":\"microsoft.cognitiveservices/accounts-AllMetrics-ServerErrors\",\"aggregation\":1,\"splitBy\":null},{\"namespace\":\"microsoft.cognitiveservices/accounts\",\"metric\":\"microsoft.cognitiveservices/accounts-AllMetrics-ClientErrors\",\"aggregation\":1,\"splitBy\":null}],\"title\":\"Server Errors vs Client Errors\",\"gridFormatType\":1,\"tileSettings\":{\"showBorder\":false}},\"name\":\"error-breakdown-chart\"}],\"fallbackResourceIds\":[\"Azure Monitor\"],\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}",
        "version": "Notebook/1.0",
        "sourceId": "[parameters('workbookSourceId')]",
        "category": "[parameters('workbookType')]"
      }
    }
  ],
  "outputs": {
    "workbookId": {
      "type": "string",
      "value": "[variables('workbookId')]"
    }
  }
}